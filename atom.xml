<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Twitch&#39;s Blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://twitchf.xyz/"/>
  <updated>2018-01-27T05:52:06.026Z</updated>
  <id>http://twitchf.xyz/</id>
  
  <author>
    <name>木木</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>flannel安装注意点</title>
    <link href="http://twitchf.xyz/2018/01/27/flannel%E5%AE%89%E8%A3%85%E6%B3%A8%E6%84%8F%E7%82%B9/"/>
    <id>http://twitchf.xyz/2018/01/27/flannel安装注意点/</id>
    <published>2018-01-27T05:41:47.000Z</published>
    <updated>2018-01-27T05:52:06.026Z</updated>
    
    <content type="html"><![CDATA[<h3 id="flannel安装注意"><a href="#flannel安装注意" class="headerlink" title="flannel安装注意"></a>flannel安装注意</h3><p>完成flannel安装后，安装参考 <a href="https://k8s-install.opsnull.com/05-%E9%83%A8%E7%BD%B2Flannel%E7%BD%91%E7%BB%9C.html" target="_blank" rel="noopener">flannel安装</a></p><p>在启动docker前，需要将flannel的网关绑定到docker启动参数上</p><ul><li>启动flannel</li><li><p>查看flannel分配的网络参数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#cat /run/flannel/subnet.env </span><br><span class="line">FLANNEL_NETWORK=172.30.0.0/16</span><br><span class="line">FLANNEL_SUBNET=172.30.45.1/24</span><br><span class="line">FLANNEL_MTU=1450</span><br><span class="line">FLANNEL_IPMASQ=false</span><br></pre></td></tr></table></figure></li><li><p>创建Docker运行参数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">使用flannel提供的脚本将subnet.env转写成Docker启动参数，创建好的启动参数位于/run/docker_opts.env文件中。</span><br><span class="line">#mk-docker-opts.sh -d /run/docker_opts.env -c</span><br><span class="line">#vim /lib/systemd/system/docker.service</span><br><span class="line">  ExecStart=/usr/bin/dockerd $DOCKER_OPTS</span><br><span class="line">  # 指定这些启动参数所在的文件位置(这个配置是新增的，同样放在Service标签下)</span><br><span class="line">  EnvironmentFile=/run/docker_opts.env</span><br></pre></td></tr></table></figure></li><li><p>重启docker</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#systemctl daemon-reload</span><br><span class="line">#systemctl restart docker</span><br></pre></td></tr></table></figure></li><li><p>查看网络</p></li></ul><p><img src="http://twitchf.xyz/images/upload/flannel.png" alt="网络"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;flannel安装注意&quot;&gt;&lt;a href=&quot;#flannel安装注意&quot; class=&quot;headerlink&quot; title=&quot;flannel安装注意&quot;&gt;&lt;/a&gt;flannel安装注意&lt;/h3&gt;&lt;p&gt;完成flannel安装后，安装参考 &lt;a href=&quot;https:/
      
    
    </summary>
    
      <category term="docker" scheme="http://twitchf.xyz/categories/docker/"/>
    
    
      <category term="k8s" scheme="http://twitchf.xyz/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>ansible的一点点记录</title>
    <link href="http://twitchf.xyz/2018/01/25/ansible%E7%9A%84%E4%B8%80%E7%82%B9%E7%82%B9%E8%AE%B0%E5%BD%95/"/>
    <id>http://twitchf.xyz/2018/01/25/ansible的一点点记录/</id>
    <published>2018-01-25T08:03:51.000Z</published>
    <updated>2018-01-25T08:10:02.609Z</updated>
    
    <content type="html"><![CDATA[<p>ansible 无需安装客户端，实现自动化分发<br>主要学习基本模块的使用，playbook的批量执行<br><a id="more"></a></p><h4 id="基本模块"><a href="#基本模块" class="headerlink" title="基本模块"></a>基本模块</h4><ul><li>hosts（测试机器）</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># cat /etc/ansible/hosts </span><br><span class="line">[test]</span><br><span class="line">192.168.102.99 #k8s99</span><br></pre></td></tr></table></figure><ul><li><p>command 在远程主机上执行命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@opsmanager ops]# ansible test -m command -a &quot;ls /tmp&quot;</span><br><span class="line">192.168.102.99 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">ansible_q2JV3u</span><br><span class="line">test.txt</span><br><span class="line">yum.log</span><br></pre></td></tr></table></figure></li><li><p>shell 执行远程机器的脚本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@opsmanager ops]# ansible test -m shell -a &quot;bash /tmp/k8s99.sh&quot;</span><br><span class="line">192.168.102.99 | SUCCESS | rc=0 &gt;</span><br></pre></td></tr></table></figure></li><li><p>script 在远程机器上执行ansible机器的脚本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@opsmanager ops]# ansible test -m script -a &quot;/tmp/ops-manager.sh&quot;</span><br><span class="line">192.168.102.99 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: true, </span><br><span class="line">    &quot;rc&quot;: 0, </span><br><span class="line">    &quot;stderr&quot;: &quot;Shared connection to 192.168.102.99 closed.\r\n&quot;, </span><br><span class="line">    &quot;stdout&quot;: &quot;&quot;, </span><br><span class="line">    &quot;stdout_lines&quot;: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>raw 类似command，支持管道传递</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@opsmanager ops]# ansible test -m raw -a &quot;cat /tmp/test.txt | wc -l&quot;</span><br><span class="line">192.168.102.99 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">2</span><br><span class="line">Shared connection to 192.168.102.99 closed.</span><br></pre></td></tr></table></figure></li><li><p>copy 拷贝ansible机器上文件到远程机器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@opsmanager ops]# ll /tmp/ansible.txt </span><br><span class="line">-rw-r--r--. 1 root root 21 Jan 18 14:18 /tmp/ansible.txt</span><br><span class="line">[root@opsmanager ops]# ansible test -m copy -a &quot;src=/tmp/ansible.txt dest=/tmp/ owner=ops group=root mode=0777&quot;</span><br><span class="line">192.168.102.99 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: true, </span><br><span class="line">    &quot;checksum&quot;: &quot;3f4c1065f5f99153dc0f992c4cbddff01cffd55f&quot;, </span><br><span class="line">    &quot;dest&quot;: &quot;/tmp/ansible.txt&quot;, </span><br><span class="line">    &quot;gid&quot;: 0, </span><br><span class="line">    &quot;group&quot;: &quot;root&quot;, </span><br><span class="line">    &quot;md5sum&quot;: &quot;8033e1095b3dca7e980bc88f39789892&quot;, </span><br><span class="line">    &quot;mode&quot;: &quot;0777&quot;, </span><br><span class="line">    &quot;owner&quot;: &quot;ops&quot;, </span><br><span class="line">    &quot;secontext&quot;: &quot;unconfined_u:object_r:admin_home_t:s0&quot;, </span><br><span class="line">    &quot;size&quot;: 21, </span><br><span class="line">    &quot;src&quot;: &quot;/root/.ansible/tmp/ansible-tmp-1516256563.17-66709211107611/source&quot;, </span><br><span class="line">    &quot;state&quot;: &quot;file&quot;, </span><br><span class="line">    &quot;uid&quot;: 1000</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">文件夹</span><br><span class="line">[root@opsmanager files]# ansible test -m copy -a &quot;src=/etc/ansible/files/discounts dest=/usr/local/&quot;</span><br><span class="line">192.168.102.99 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: true, </span><br><span class="line">    &quot;dest&quot;: &quot;/usr/local/&quot;, </span><br><span class="line">    &quot;src&quot;: &quot;/etc/ansible/files/discounts&quot;</span><br><span class="line">&#125;</span><br><span class="line">[root@opsmanager files]# ll -h</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x. 3 root root 55 Jan 18 16:17 discounts</span><br></pre></td></tr></table></figure></li><li><p>file 操作远程主机文件及文件夹(rescure 递归)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@opsmanager ops]# ansible test -m file -a &quot;dest=/tmp/k8s99 recurse=yes mode=755 owner=ops group=ops&quot;</span><br><span class="line">192.168.102.99 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: true, </span><br><span class="line">    &quot;gid&quot;: 1000, </span><br><span class="line">    &quot;group&quot;: &quot;ops&quot;, </span><br><span class="line">    &quot;mode&quot;: &quot;0755&quot;, </span><br><span class="line">    &quot;owner&quot;: &quot;ops&quot;, </span><br><span class="line">    &quot;path&quot;: &quot;/tmp/k8s99&quot;, </span><br><span class="line">    &quot;secontext&quot;: &quot;unconfined_u:object_r:user_tmp_t:s0&quot;, </span><br><span class="line">    &quot;size&quot;: 22, </span><br><span class="line">    &quot;state&quot;: &quot;directory&quot;, </span><br><span class="line">    &quot;uid&quot;: 1000</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>user 添加删除用户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">添加</span><br><span class="line">[root@opsmanager ops]# ansible test -m user -a &quot;name=test group=test  state=present&quot;</span><br><span class="line">192.168.102.99 | FAILED! =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: false, </span><br><span class="line">    &quot;msg&quot;: &quot;Group test does not exist&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@opsmanager ops]# ansible test -m user -a &quot;name=test  state=present&quot;</span><br><span class="line">192.168.102.99 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: true, </span><br><span class="line">    &quot;comment&quot;: &quot;&quot;, </span><br><span class="line">    &quot;createhome&quot;: true, </span><br><span class="line">    &quot;group&quot;: 1002, </span><br><span class="line">    &quot;home&quot;: &quot;/home/test&quot;, </span><br><span class="line">    &quot;name&quot;: &quot;test&quot;, </span><br><span class="line">    &quot;shell&quot;: &quot;/bin/bash&quot;, </span><br><span class="line">    &quot;state&quot;: &quot;present&quot;, </span><br><span class="line">    &quot;system&quot;: false, </span><br><span class="line">    &quot;uid&quot;: 1002</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">删除</span><br><span class="line">[root@opsmanager ops]# ansible test -m user -a &quot;name=test  state=absent remove=yes&quot;</span><br><span class="line">192.168.102.99 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: true, </span><br><span class="line">    &quot;force&quot;: false, </span><br><span class="line">    &quot;name&quot;: &quot;test&quot;, </span><br><span class="line">    &quot;remove&quot;: true, </span><br><span class="line">    &quot;state&quot;: &quot;absent&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>yum模块</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">卸载</span><br><span class="line">ansible test -m yum -a &quot;state=absent name=lrzsz&quot;</span><br><span class="line"></span><br><span class="line">安装</span><br><span class="line">[root@opsmanager ops]# ansible test -m yum -a &quot;state=present name=lrzsz&quot;</span><br><span class="line">192.168.102.99 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: true, </span><br><span class="line">    &quot;msg&quot;: &quot;&quot;, </span><br><span class="line">    &quot;rc&quot;: 0, </span><br><span class="line">    &quot;results&quot;: [</span><br><span class="line">        &quot;Loaded plugins: fastestmirror\nLoading mirror speeds from cached hostfile\n * base: mirrors.aliyun.com\n * epel: mirrors.aliyun.com\n * extras: mirrors.aliyun.com\n * updates: mirrors.aliyun.com\nResolving Dependencies\n--&gt; Running transaction check\n---&gt; Package lrzsz.x86_64 0:0.12.20-36.el7 will be installed\n--&gt; Finished Dependency Resolution\n\nDependencies Resolved\n\n================================================================================\n Package         Arch             Version                  Repository      Size\n================================================================================\nInstalling:\n lrzsz           x86_64           0.12.20-36.el7           base            78 k\n\nTransaction Summary\n================================================================================\nInstall  1 Package\n\nTotal download size: 78 k\nInstalled size: 181 k\nDownloading packages:\nRunning transaction check\nRunning transaction test\nTransaction test succeeded\nRunning transaction\n  Installing : lrzsz-0.12.20-36.el7.x86_64                                  1/1 \n  Verifying  : lrzsz-0.12.20-36.el7.x86_64                                  1/1 \n\nInstalled:\n  lrzsz.x86_64 0:0.12.20-36.el7                                                 \n\nComplete!\n&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>service 操作远程主机服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">启动nginx，设置开机启动</span><br><span class="line">ansible test -m service -a &quot;name=nginx state=started enabled=yes&quot;</span><br></pre></td></tr></table></figure></li><li><p>synchronize 文件/文件夹推送，属性与ansible主机一致，需要安装rsync</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@opsmanager tmp]# ansible test -m synchronize -a &quot;src=/tmp/ansible.txt dest=/tmp/ansible.txt&quot;</span><br><span class="line">192.168.102.99 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: true, </span><br><span class="line">    &quot;cmd&quot;: &quot;/bin/rsync --delay-updates -F --compress --archive --rsh=/bin/ssh -S none -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null --out-format=&lt;&lt;CHANGED&gt;&gt;%i %n%L /tmp/ansible.txt 192.168.102.99:/tmp/ansible.txt&quot;, </span><br><span class="line">    &quot;msg&quot;: &quot;&lt;f.st...... ansible.txt\n&quot;, </span><br><span class="line">    &quot;rc&quot;: 0, </span><br><span class="line">    &quot;stdout_lines&quot;: [</span><br><span class="line">        &quot;&lt;f.st...... ansible.txt&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>cron 计划任务,同一name为一条crontable</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">添加</span><br><span class="line">[root@opsmanager tmp]# ansible test -m cron -a &apos;name=&quot;test cron&quot; job=&quot;/bin/bash /tmp/test.sh&quot; minute=*/10 hour=* day=* month=* weekday=*&apos;</span><br><span class="line">192.168.102.99 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: true, </span><br><span class="line">    &quot;envs&quot;: [], </span><br><span class="line">    &quot;jobs&quot;: [</span><br><span class="line">        &quot;test cron&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">删除</span><br><span class="line">[root@opsmanager tmp]# ansible test -m cron -a &apos;name=&quot;test cron2&quot; job=&quot;/bin/bash /tmp/test.sh&quot; minute=*/20 hour=* day=* month=* weekday=* state=absent&apos;</span><br><span class="line">192.168.102.99 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: true, </span><br><span class="line">    &quot;envs&quot;: [], </span><br><span class="line">    &quot;jobs&quot;: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="ansible-playbook"><a href="#ansible-playbook" class="headerlink" title="ansible playbook"></a>ansible playbook</h4><ul><li><p>文件列表</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@opsmanager ansible]# tree .</span><br><span class="line">.</span><br><span class="line">├── ansible.cfg     #ansible配置</span><br><span class="line">├── files       #一些文件</span><br><span class="line">│   ├── discounts  #html</span><br><span class="line">│   │   ├── index.css</span><br><span class="line">│   │   └── index.html</span><br><span class="line">│   └── server.conf #nginx配置</span><br><span class="line">├── hosts  #ansible需要控制的机器列表</span><br><span class="line">├── playbook-test.retry  </span><br><span class="line">├── playbook-test.yml #playbook yml文件</span><br><span class="line">└── roles #</span><br></pre></td></tr></table></figure></li><li><p>hosts</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[test]</span><br><span class="line">192.168.102.99</span><br></pre></td></tr></table></figure></li><li><p>playbook yml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">- hosts: test   #指定机器</span><br><span class="line">  vars:         #定义变量</span><br><span class="line">    port: 80</span><br><span class="line">    server: test.chenfan.com</span><br><span class="line">    root: /usr/local/discounts</span><br><span class="line">    index: discounts.html discounts.htm</span><br><span class="line">  remote_user: root  #指定运行的用户(权限)</span><br><span class="line">  tasks:             #任务</span><br><span class="line">  - name: yum the latest apache</span><br><span class="line">    yum: name=nginx state=latest</span><br><span class="line">  - name: copy html to hosts</span><br><span class="line">    copy: src=/etc/ansible/files/discounts dest=/usr/local/</span><br><span class="line">  - name: copy nginx config</span><br><span class="line">    template: src=/etc/ansible/files/server.conf dest=/etc/nginx/conf.d/     #发送带变量的文件</span><br><span class="line">    notify: start nginx</span><br><span class="line">  handlers:</span><br><span class="line">  - name: start nginx</span><br><span class="line">    service: name=nginx state=started</span><br></pre></td></tr></table></figure></li><li><p>server.conf nginx配置文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    client_max_body_size 10M;</span><br><span class="line">    listen       &#123;&#123;port&#125;&#125;;  #读取template中变量</span><br><span class="line">    server_name &#123;&#123;server&#125;&#125;;</span><br><span class="line">    gzip         on;</span><br><span class="line">    gzip_types   text/plain text/css application/json application/x-javascript text/xml application/xml text/javascript;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">      root   &#123;&#123;root&#125;&#125;;</span><br><span class="line">      index  &#123;&#123;index&#125;&#125;;</span><br><span class="line">      autoindex on; # 索引</span><br><span class="line">      autoindex_exact_size on; # 显示文件大小</span><br><span class="line">      autoindex_localtime on; # 显示文件时间</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ansible 无需安装客户端，实现自动化分发&lt;br&gt;主要学习基本模块的使用，playbook的批量执行&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="http://twitchf.xyz/categories/linux/"/>
    
    
      <category term="ansible" scheme="http://twitchf.xyz/tags/ansible/"/>
    
  </entry>
  
  <entry>
    <title>harbor部署</title>
    <link href="http://twitchf.xyz/2018/01/25/harbor%E9%83%A8%E7%BD%B2/"/>
    <id>http://twitchf.xyz/2018/01/25/harbor部署/</id>
    <published>2018-01-25T06:47:59.000Z</published>
    <updated>2018-01-25T07:11:13.458Z</updated>
    
    <content type="html"><![CDATA[<h3 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h3><p>docker-compose</p><p>docker</p><p>harbor离线包</p><h3 id="证书生成"><a href="#证书生成" class="headerlink" title="证书生成"></a>证书生成</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#mkdir -p /data/cert</span><br><span class="line">#cd /data/cert</span><br><span class="line"></span><br><span class="line">创建CA根证书</span><br><span class="line">#openssl req  -newkey rsa:4096 -nodes -sha256 -keyout ca.key -x509 -days 365 -out ca.crt -subj &quot;/C=CN/L=wuhan/O=lisea/CN=harbor-registry&quot;</span><br><span class="line"></span><br><span class="line">生成证书签名，访问域名为hun.fjf.com</span><br><span class="line">#openssl req -newkey rsa:4096 -nodes -sha256 -keyout hub.fjf.com.key -out server.csr -subj &quot;/C=CN/L=wuhan/O=lisea/CN=hub.fjf.com&quot;</span><br><span class="line"></span><br><span class="line">生成主机证书</span><br><span class="line">#openssl x509 -req -days 365 -in server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out hub.fjf.com.crt</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="修改harbor-cfg"><a href="#修改harbor-cfg" class="headerlink" title="修改harbor.cfg"></a>修改harbor.cfg</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">hostname = hub.fjf.com          # 指定私有仓库的主机名,可以是IP地址，也可以是域名   </span><br><span class="line">ui_url_protocol = https             # 用户访问私仓时使用的协议，默认时http，配置成https</span><br><span class="line">db_password = root123           　　# 指定mysql数据库管理员密码</span><br><span class="line">harbor_admin_password：Harbor12345  # harbor的管理员账户密码</span><br><span class="line">ssl_cert = /data/cert/hub.fjf.com.crt  　　# 设置证书文件路径</span><br><span class="line">ssl_cert_key = /data/cert/hub.fjf.com.key  # 设置证书密钥文件路径</span><br></pre></td></tr></table></figure><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#./install</span><br></pre></td></tr></table></figure><h3 id="docker客户端访问hub"><a href="#docker客户端访问hub" class="headerlink" title="docker客户端访问hub"></a>docker客户端访问hub</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># mkdir /etc/docker/certs.d/hub.fjf.com</span><br><span class="line">将hub端创建的ca.crt 拷贝至/etc/docker/certs.d/hub.fjf.com下</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;准备&quot;&gt;&lt;a href=&quot;#准备&quot; class=&quot;headerlink&quot; title=&quot;准备&quot;&gt;&lt;/a&gt;准备&lt;/h3&gt;&lt;p&gt;docker-compose&lt;/p&gt;
&lt;p&gt;docker&lt;/p&gt;
&lt;p&gt;harbor离线包&lt;/p&gt;
&lt;h3 id=&quot;证书生成&quot;&gt;&lt;a href=&quot;#证书生成&quot; class=&quot;headerlink&quot; title=&quot;证书生成&quot;&gt;&lt;/a&gt;证书生成&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;#mkdir -p /data/cert&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#cd /data/cert&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;创建CA根证书&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#openssl req  -newkey rsa:4096 -nodes -sha256 -keyout ca.key -x509 -days 365 -out ca.crt -subj &amp;quot;/C=CN/L=wuhan/O=lisea/CN=harbor-registry&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;生成证书签名，访问域名为hun.fjf.com&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#openssl req -newkey rsa:4096 -nodes -sha256 -keyout hub.fjf.com.key -out server.csr -subj &amp;quot;/C=CN/L=wuhan/O=lisea/CN=hub.fjf.com&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;生成主机证书&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#openssl x509 -req -days 365 -in server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out hub.fjf.com.crt&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="docker" scheme="http://twitchf.xyz/categories/docker/"/>
    
    
      <category term="docker" scheme="http://twitchf.xyz/tags/docker/"/>
    
      <category term="hub" scheme="http://twitchf.xyz/tags/hub/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://twitchf.xyz/2018/01/24/hello-world/"/>
    <id>http://twitchf.xyz/2018/01/24/hello-world/</id>
    <published>2018-01-24T06:42:10.496Z</published>
    <updated>2018-01-25T07:11:42.462Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><a id="more"></a><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;documentation&lt;/a&gt; for more info. If you get any problems when using Hexo, you can find the answer in &lt;a href=&quot;https://hexo.io/docs/troubleshooting.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;troubleshooting&lt;/a&gt; or you can ask me on &lt;a href=&quot;https://github.com/hexojs/hexo/issues&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;GitHub&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;Quick-Start&quot;&gt;&lt;a href=&quot;#Quick-Start&quot; class=&quot;headerlink&quot; title=&quot;Quick Start&quot;&gt;&lt;/a&gt;Quick Start&lt;/h2&gt;&lt;h3 id=&quot;Create-a-new-post&quot;&gt;&lt;a href=&quot;#Create-a-new-post&quot; class=&quot;headerlink&quot; title=&quot;Create a new post&quot;&gt;&lt;/a&gt;Create a new post&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ hexo new &lt;span class=&quot;string&quot;&gt;&quot;My New Post&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;More info: &lt;a href=&quot;https://hexo.io/docs/writing.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Writing&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;Run-server&quot;&gt;&lt;a href=&quot;#Run-server&quot; class=&quot;headerlink&quot; title=&quot;Run server&quot;&gt;&lt;/a&gt;Run server&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ hexo server&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="test" scheme="http://twitchf.xyz/tags/test/"/>
    
  </entry>
  
</feed>
